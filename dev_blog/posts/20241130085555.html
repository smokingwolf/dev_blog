<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>ウディタ3.5開発中その6　キー入力･XY配列･Git間接対応</title>
<script>
function toggle(id){
 var e=document.getElementById(id);
 if(e.style.display==='none'){e.style.display='block';}else{e.style.display='none';}
}
</script>
</head>
<body>
<h1>ウディタ3.5開発中その6　キー入力･XY配列･Git間接対応</h1>
<div>2024-11-30 08:55:55</div>
<div><TABLE padding="15px"><tr><td align="left" style="line-height: 1.5; word-break: break-all;">　ということでウディタ3.5開発の経過報告、その6です！
　今回で最終回かと思いましたが、データのテキスト入出力機能を実装してたら想定以上に時間がかかっちゃったのでまだまだ続きそうです。

<HR><span style="font-size:large;"><B>●念願の「XY配列」（二次元配列）機能を搭載！</B></span><HR>
　一部の人には念願だった二次元配列機能が搭載されます！　その名も『XY配列』！
　数値データのみが入る、<span style="color: #d50000"><B>最大『10000×10000』の二次元配列</B></span>を無限に作ることができる機能で、1つずつの読み書きだけでなくCSVからの入出力やソートなども可能です！

<img src="https://silversecond.net/data/p_diary5/20241130B.png" border="1" style="max-width:520px;" loading="lazy">

　使い勝手としては、<B>「数値だけを入れられるDB(ただし項目数は100から10000まで拡張可)が無限に作れる」</B>みたいな感触となっております。
　
　XY配列の入力画面は以下の通り！　……といっても、この「XY配列」機能はインターフェースとしては従来のDBと並んでいる扱いなので、そのまんま「DB操作」画面です。
<img src="https://silversecond.net/data/p_diary5/20241130A.png" border="1" style="max-width:520px;" loading="lazy">

<B>【特徴】</B>

<B>●「配列番号/名前」には好きな「番号」または「文字列(名前)」を指定できます。
　「X列」と「Y列」には「数値(変数)」だけ指定可能です。</B>
　→　この「配列」は、あらかじめ用意する必要はありません。なかった場合、数値を格納した時点で勝手に作られます。

●「X列」と「Y列」は、使った番号まで<B>自動で配列が拡張</B>されます。
　サイズの限界は最大でX、Y共に<B>「10000」</B>までです。

●「新データ挿入・抜き取り・コピー・ソート・CSV入出力」機能も使用可能です。

●XY配列の内容はもちろんセーブデータにも保存されます。



<B>【どういう場面で使える？】</B>

●自作システムを作ってる最中に出てくる、「DBを作るほどでもないけど大量の数値を扱いたい！」という場面で非常に有用です！
　たとえば「素早さが高い順に行動順の並び変えをしたい！」みたいな処理をするときも、今後はいちいち可変DBに計算用のDBを作る必要はなく、XY配列だけで完結できてしまいます！

●単純に自作システム内で、コモンセルフの足りない分を補うのにも有用です！
（使えるのは「数値」だけですのでそこはご注意を）

●コモンイベント配布においても、処理がほぼ数値データだけで済む場合は、<span style="color: #d50000"><B>わざわざ可変DBの新たなタイプを作らなくてもXY配列だけで用が済む</B></span>ようになります！　コモン導入がシンプルに！
<span style="color: #42a5f5">　→　その場合、使用されるXY配列の名前は「<B>(作者名)_(コモン名)_1</B>」みたいにしておいてくださると他のコモン作者さまとバッティングしなくなるので安心ですね。</span>

●他には『マップに関わるなんらかの処理で使う』というのがすぐ思いつきます！
　「マップと同じサイズのXY配列」を作って、何かの値を格納したり読んだりする、ということが従来よりも圧倒的に簡単にできるでしょう。

●「名前で一部の変数を管理したい」という需要にも応えられます！
　たとえば1x1の配列を使用し、配列名に「[物語用]ウルフがトイレに行ったフラグ」などと入れれば名前でのフラグ管理も可能になります。

●今後、2次元配列を入出力とする「何か」を私が作る場合でも気軽に色々できます！
　今回の更新では、<span style="color: #d50000"><B>【4つのXY配列「アルファ値・赤・緑・青」を指定すれば、その配列のアルファ、RGB値で画像を出力できる隠しコード】</B></span>みたいな機能も検討中です。ウディタをちょっとしたペイントツールにすることもできますよ！


　といった感じで、地味ですが利便性が上がり、夢も広がります！
　


<HR><span style="font-size:large;"><B>●データのテキスト入出力機能！</B></span><HR>
　データのテキスト入出力機能！　これは入れるか迷ったのですが、今回入れなかったらたぶんあと3年くらい搭載されなくなりそうだったので10日くらいかけて思い切って実装していました。10日で実装できたのなら割のいい投資です。

　これは、ゲーム設定、各データベース、コモンイベント、タイル設定、マップファイルを「TXTファイル」でも出力、ないし読み込み可能にする機能です。
　これができると何が嬉しいって、Gitで差分管理やバージョン管理がしやすくなるんですよ！
　というのも、これまではウディタの各種ファイルは、.datや.mpsのような、人間が読めない「バイナリファイル」で保存されていたため、Gitで差分を取ったりするのが難しかったのです。ですがこれが「テキストファイル」なら、しっかり管理してくれます。

<span style="color:#666666"><span style="font-size:x-small;">↓マップファイルのテキスト版、最初の方にマップチップ情報、（見えない）後ろにイベントデータが書き込まれています</span></span>
<img src="https://silversecond.net/data/p_diary5/20241130D.png" border="1" style="max-width:520px;" loading="lazy">


<B>【Gitを使うと何ができる？】</B>
●定期的にコミットすることで、コミット単位で<B><span style="color: #d50000">書き換えた場所だけを後から確認できる</span></B>。
　致命的なバグが起きてしまったけれど原因が分からないとき、「いじった部分」だけを追跡すればどこが悪かったのかを見つけ出しやすくなります。

●前にコミットした時点の内容に<B><span style="color: #d50000">巻き戻せる</span></B>！　バグが起きて困ったときに、データを巻き戻したりできます。

●他の人のテキストファイルと、<B><span style="color: #d50000">修正部分を「マージ（合体）」させる</span></B>ことができる。うまく作業の仕組み作りができれば、遠隔での共同作業もいくらか可能になるかも！

→　といったGit利用におけるこれらの強みを、ウディタでも一手間かかるものの享受できるようになります！
　ただ最初はGitの扱いがだいぶ難しいと思いますので、あくまでできる人向けです（私は分からないなりに色々操作した結果、過去のバックアップデータを全部吹っ飛ばしたことがあります）



<B>【TXT入出力にはどんなモードがある？】</B>
　このデータのTXT入出力機能には以下のモードがあります！

<B>●「エディターオプション」から、ファイルのセーブ時に自動でTXTファイルも保存されるよう切り替えできる。</B>
→　一番シンプルなモード。ゲーム設定やコモン、DB、マップなどを保存した際に自動でTXTも出力されます。ただ環境によっては少し保存処理が重くなるかもしれません。

<B>●「エディターオプション」から、指定したフォルダに「TXTファイルをまとめて出力」、ないし「TXTファイルからまとめて読込」できる。</B>
→　Gitのバージョン管理では全ファイルをまとめて戻すことが多いので、エディター内からも「まとめてTXT読込」でデータを復元できる機能を用意しておきました。その逆の「まとめてTXT出力」機能はたまに出力したい人向け。

<B>●コマンドラインでまとめて出力・読み込みできる。</B>
<span style="color: #d50000"><B>　Editor.exe -txtoutput -target ALL -txt_folder Data_AutoTXT</B></span>
　みたいにコマンドプロンプトで入れると、「ALL」対象である「基本データ(ゲーム設定･DB･コモン･タイル設定･マップ)」と「全マップ」が「<B>Data_AutoTXT</B>」フォルダ以下にフォルダ構造を再現してTXT出力されたりします。逆に、そこから読み込んで各ファイルを復元する「-txtinput」モードもあります。
→　batファイルなどを使える人なら、「Gitにコミットする直前だけまとめてTXT出力する」みたいな工夫もできるはずです。
→　「-target」オプションは 「ALL(全部）」の他に「BASIC（基本データのみ）」と「MAP（全マップ）」があります。



<HR><span style="font-size:large;"><B>●キー入力強化！　「新押し」と「離した時」の取得が可能に！</B></span><HR>
<img src="https://silversecond.net/data/p_diary5/20241130C.jpg" border="1" style="max-width:520px;" loading="lazy">

　もう上の画像を見てくださるだけでピンと来る方も多いかもしれません！
　3.5ではいつも通りの「押されている状態」を得るだけでなく、「新たに押された瞬間」「離した瞬間」の1フレームだけ値を返す、という取得方法が追加されます！
　
　いちおう自作コモンイベントでもこの処理自体は作れるのですが、従来は毎フレーム「そのキーが押されているか」を記録し続けなければ「このフレーム中に新たに押されたか」「離されたか」を知ることは難しく、意外に手間な部分でした。なんならうまくまだ作れない人もいらっしゃるでしょう。
　そこがワンコマンドで作れるようになったので、以後はだいぶ気楽に使うことができます！


<B>【「新押し」機能はタイピングゲームに強そう！】</B>
　従来の「押されている状態」を使い、「キーボード全キー（を取得）」と合わせてタイピングゲームを作っておられた方もいらっしゃるかもしれませんが、実はこれだと同時押しされている際、<B>「同時押しされている中で最も小さいキーコードの値だけが返される」</B>という問題がありました。つまりAキー(130)から指が離れてない状態でSキー(131)を押しても、判定上は「A(130)」のキー値しか返されないという状況になってしまうのです。

　ですが！　3.5からは「新押し時のみ取得」で「全キー」を取得するようにすれば、最初に押されたキーは1フレームで返し終わってしまい、別キーが受理可能になるので、<B>「<span style="color: #d50000">「新押し時のみ取得」を使えば前のキーを押したまま別のキーを押してもちゃんと新しい方のキーが返される」</span></B>ようになるのです！　これはタイピングゲームがすごい作りやすくなりますよ！
<span style="color: #808080">（といっても、0.016秒内に2キーを同時押しされるとやっぱり小さいキーコード1つしか認識されないという問題はあるので、そこまで気にされる方は従来通り1キーずつ全チェックされるしかないんですけれども）</span>

　「1フレーム差あれば全キー受理される」くらいの精度のゲームであれば作るのが相当楽になるはずですので、タイピングゲーム作りに挑戦される方もこの機会にぜひご利用ください！


　もちろんアクションゲームやRPGでもキー反応をより正確にすることができるはずですので、どんなゲームにおいても、ぜひこの「新押し時のみ」「離され時のみ」判定は役立つと思います！　私もいっぱい使う場面がありそうです。

<HR>
　といった感じで、今回も「作り方」から変わってしまうような重要な新機能がいろいろ実装できました！
　
　この調子だと公開時期がほぼクリスマスになったりするかもしれませんが、どうか気長にお待ちください！　まだ故人の都合で、リアルの用事もいろいろ発生してしまっているものでして。


　また、<B><a target="_blank" href="https://silversecond.booth.pm/items/4455722">BOOTH</a></B>などでご支援くださっている方、本当にありがとうございます！
　いよいよウディタプロ版の売上げも停滞しつつあり、ウディタプロ版や関連するBOOTH売上に対する作業時給がこの3ヶ月間ずっと200円前後になっているので、もうこれが最後の大規模更新のチャンスだと思って色んなものを体中から出しながらも色々追加しておりました！
　が、みなさんのご支援のおかげでもう一踏ん張りがんばれております！　本当に助かります！

　引き続きラストスパート、がんばっていきます！</td></tr></table></div>

</body>
</html>